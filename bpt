#!/bin/sh
#
# BlackBerry Pentesting Tools - Simple bash script to automate task performed during blackberry pentests.
# 
# Author: Quentin Kaiser <quentin_AT_gremwell.com>
#

if [ "$1" = "setup" ]; then
	if [ -f /etc/lsb-release ]; then 
		if [ ! -z `which barry` ]; then
			echo "[+] Installing barry ...";
			sudo apt-get install -y barry-doc barry-util barrybackup-gui barrydesktop 
		fi
	else
		echo "[!] barry packages are only available to Debian based distributions :/"
	fi
	for i in `find coddec -name '*.java'`; do javac $i; done
elif [ "$1" = "device" ]; then
	if [ ! -z `which bidentify` ]; then
		bidentify
		if [ "$2" = "" ]; then
			btool -t 
		else
			btool -P $2
		fi
	else
		echo "[!] bidentify is not installed. Please run $0 setup first."
	fi
elif [ "$1" = "pm" ]; then
	if [ ! -z `which bjavaloader` ]; then
		if [ "$2" = "" ]; then
			bjavaloader dir | cut -d" " -f3 | grep -v "^$"
		else
			bjavaloader -P $2 dir | cut -d" " -f3 | grep -v "^$"
		fi
	else
		echo "[!] bjavaloader is not installed. Please run $0 setup first."
	fi
elif [ "$1" = "logs" ]; then
	if [ ! -z `which bjavaloader` ]; then
		if [ "$2" = "" ]; then
			bjavaloader eventlog
		else
			bjavaloader -P $2 eventlog
		fi
	else
		echo "[!] bjavaloader is not installed. Please run $0 setup first."
	fi
elif [ "$1" = "crashlogs" ]; then
	if [ ! -z `which bjavaloader` ]; then
		if [ "$2" = "" ]; then
			bjavaloader logstacktraces
		else
			bjavaloader -P $2 logstacktraces
		fi
	else
		echo "[!] bjavaloader is not installed. Please run $0 setup first."
	fi
elif [ "$1" = "decompile" ]; then
	if [ "$2" = "" ]; then
		echo "[!] You need to provide a COD file path."
	else
		mkdir -p decompiled
		java -classpath coddec/src net.rim.tools.compiler.Compiler $2	
		strings $2 > decompiled/strings.txt
		binwalk --dd='.*' $2
	fi
else
	echo "Usage: $0 command [options]\n\nAvailable commands:\n\t* setup: install all dependencies\n\t* device [device password]: list device info\n\t* pm [device password]: list installed applications\n\t* logs [device password]: display device syslogs\n\t* crashlogs [device password]: display stack traces\n\t* decompile [cod file]: decompile a .cod application\n"
fi
