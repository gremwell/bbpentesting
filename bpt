#!/bin/sh
#
# BlackBerry Pentesting Tools - Simple bash script to automate task performed during blackberry pentests.
# 
# Author: Quentin Kaiser <quentin_AT_gremwell.com>
#

if [ "$1" = "setup" ]; then
	if [ -f /etc/lsb-release ]; then 
		if [ ! -z `which barry` ]; then
			echo "[+] Installing barry ...";
			sudo apt-get install -y barry-doc barry-util barrybackup-gui barrydesktop 
		fi
	else
		echo "[!] barry packages are only available to Debian based distributions :/"
	fi
	for i in `find coddec -name '*.java'`; do javac $i; done
elif [ "$1" = "device" ]; then
	if [ ! -z `which bidentify` ]; then
		bidentify
		if [ -z $2 ]; then
			btool -P $2 
		else
			btool -t
		fi
	else
		echo "[!] bidentify is not installed. Please run $0 setup first."
	fi
elif [ "$1" = "pm" ]; then
	if [ ! -z `which bjavaloader` ]; then
		bjavaloader -P $2 dir | cut -d" " -f3 | grep -v "^$"
	else
		echo "[!] bjavaloader is not installed. Please run $0 setup first."
	fi
elif [ "$1" = "logs" ]; then
	if [ ! -z `which bjavaloader` ]; then
		bjavaloader -P $2 eventlog
	else
		echo "[!] bjavaloader is not installed. Please run $0 setup first."
	fi
elif [ "$1" = "crashlogs" ]; then
	if [ ! -z `which bjavaloader` ]; then
		bjavaloader -P $2 logstacktraces
	else
		echo "[!] bjavaloader is not installed. Please run $0 setup first."
	fi
elif [ "$1" = "decompile" ]; then
	mkdir -p decompiled
	java -classpath coddec/src net.rim.tools.compiler.Compiler $2	
	strings $2 > decompiled/strings.txt
	binwalk --dd='.*' $2
else
	echo "Usage: $0 command [options]\n\nAvailable commands:\n\t* setup: install all dependencies\n\t* device: list device info\n\t* pm: list installed applications\n\t* logcat: display device syslogs\n\t* crashlogs: display stack traces\n\t* decompile: decompile a .cod application\n"
fi
